---
title: 'Node.js åŒ…ç®¡ç†åŠ npm ä¾èµ–å®‰è£…æœºåˆ¶'
excerpt: 'Node.js åŒ…ç®¡ç†å†å²ï¼Œnpmã€yarnã€pnpm ä¹‹é—´çš„å…³ç³»åŒºåˆ«ï¼Œpnpm çš„ä¼˜åŠ¿ï¼Œnpm install åå‘ç”Ÿäº†ä»€ä¹ˆ? node_modules ä¸ºä»€ä¹ˆè¿™ä¹ˆé‡'
date: '2022-03-23 17:20:47'
tags: npm node.js pnpm yarn packages.json node_modules
---


## ä¸»è¦åˆ†äº«æ¢è®¨ä»¥ä¸‹å‡ ä¸ªé—®é¢˜

- Node.js åŒ…ç®¡ç†ã€npmã€cnpmã€yarnã€pnpm ä¹‹é—´çš„å…³ç³»åŒºåˆ«ï¼Œpnpm çš„ä¼˜åŠ¿
- npm åŒ…ç®¡ç†å†å²
- npm install åå‘ç”Ÿäº†ä»€ä¹ˆ? æ¨¡å—å®‰è£…æœºåˆ¶
- Why node_modules are so heavy ? ( node_modules ä¸ºä»€ä¹ˆè¿™ä¹ˆé‡ï¼‰

![](https://assets.wuxinhua.com/blog/assets/npm/image-1%20%281%29.png)

- å¯¹äºä¸åŒçš„ä¾èµ–ä¸­åˆå…±åŒä¾èµ–æŸä¸€åŒ…çš„ä¸åŒç‰ˆæœ¬ï¼ŒåŒ…ç®¡ç†å·¥å…·ä¼šé‡‡å–ä»€ä¹ˆæ ·çš„ç­–ç•¥ï¼Ÿ
- æˆ‘åœ¨ä¸€ä¸ªé¡¹ç›®ä¸­ç”¨äº†yarnå®‰è£…åï¼Œå†ä½¿ç”¨ npm å®‰è£…åæ˜¯å¦ okï¼ŒåŒç†å…¶ä»–å‡ ç§ç»„åˆã€‚

## æµè§ˆå‰å¿…è¯»

ä½œä¸ºå‰ç«¯å¼€å‘å·¥ç¨‹å¸ˆï¼Œæåˆ°åŒ…ã€æ¨¡å—ç®¡ç†ç­‰å†…å®¹ï¼Œå¤§å®¶ç¬¬ä¸€æƒ³åˆ°çš„åº”è¯¥å°±æ˜¯ npmï¼Œnpm install ã€npm run ç­‰ä¹Ÿæ˜¯æ—¥å¸¸ä½¿ç”¨é¢‘ç‡æœ€é«˜çš„å‡ ä¸ªå‘½ä»¤ï¼Œä½†æ˜¯æˆ‘ä»¬å¾ˆå°‘å»å…³æ³¨è¿™äº›å‘½ä»¤æ‰§è¡Œä¹‹å npm ä¸ºæˆ‘ä»¬åšäº†é‚£äº›äº‹ï¼Œä»¥åŠæŠŠåŒ…å®‰è£…åˆ° node_modules ä¸­çš„ç»“æ„å…·ä½“æ˜¯æ€æ ·çš„ï¼Œä¸ºä»€ä¹ˆä¼šæ–°å¢ package.lockæ–‡ä»¶ç­‰ç­‰? æœ¬æ–‡å°†å¸¦ç€è¿™äº›é—®é¢˜å»äº†è§£ä¸€ä¸‹ nodejs åŒ…ç®¡ç†çš„å†å²ä»¥åŠå…¶ä¸­çš„ä¸€äº›å®¹æ˜“å¿½ç•¥çš„ç»†èŠ‚ã€‚ åœ¨äº†è§£ npm ã€yarn ã€pnpm å·¥å…·ä¹‹å‰æˆ‘ä»¬å¯ä»¥å…ˆè®¤è¯†æˆ–äº†è§£ä¸€ä¸‹è¿™å‡ ä¸ªå¸¸è§çš„åç§°ï¼Œå¯¹æ¥ä¸‹æ¥çš„è®¨è®ºä¹Ÿä¼šæœ‰ä¸€äº›å¸®åŠ©ï¼Œpackage(åŒ…)ã€module(æ¨¡å—)ï¼Œä»€ä¹ˆçš„æ–‡ä»¶å¯ä»¥ç§°ä¸ºä¸€ä¸ª package(åŒ…)? ä»€ä¹ˆåˆæ˜¯æ¨¡å—ï¼Ÿ

- Module ä»»ä½•æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹èƒ½è¢« Node.js require æ–¹æ³•åŠ è½½çš„éƒ½å¯ä»¥è§†ä¸ºä¸€ä¸ª module
- Package åŒ…æ˜¯ä¸€ä¸ªç”± package.json æè¿°çš„æ–‡ä»¶æˆ–ç›®å½•

## ä»€ä¹ˆæ˜¯åŒ…ç®¡ç†å™¨ï¼Ÿ

å„ç§è¯­è¨€åŸºæœ¬éƒ½æœ‰è‡ªå·±çš„åŒ…ç®¡ç†å·¥å…·ï¼ŒRubyçš„è½¯ä»¶åŒ…å•å…ƒä¸º[RubyGem](https://link.zhihu.com/?target=https://rubygems.org/)ï¼ŒPython æœ‰ [PyPi](https://pypi.org/) ï¼ŒJavaScritp æœ‰ [npm](https://www.npmjs.com/)ï¼Œé™¤äº†è¯­è¨€æœ‰åŒ…ç®¡ç†å·¥å…·ä¹‹å¤–ï¼Œæ“ä½œç³»ç»Ÿä¹Ÿæœ‰åŒ…ç®¡ç†å™¨ï¼Œæˆ‘ä»¬ä»æœ€ Linux çš„åŒ…ç®¡ç†å™¨è¯´èµ·ï¼Œç®€å•å¾—æ¥è¯´ package manager "åŒ…ç®¡ç†å™¨"æˆ–â€œè½¯ä»¶åŒ…ç®¡ç†å™¨â€æ˜¯ä¸€ç§å·¥å…·ï¼ŒåŒ…ç®¡ç†å™¨å¯ä»¥æ˜¯ä¸€ç§ GUI å›¾å½¢åº”ç”¨ä¹Ÿå¯ä»¥æ˜¯ cli å‘½ä»¤è¡Œå·¥å…·ï¼Œå…è®¸ç”¨æˆ·åœ¨æ“ä½œç³»ç»Ÿã€æˆ–ç‰¹å®šç¯å¢ƒä¸Šå®‰è£…ã€å‡çº§ã€åˆ é™¤ç®¡ç†è½¯ä»¶åŒ…ï¼Œå…¶å®å¹¶ä¸æ˜¯åªæœ‰ MacOS å’Œ Linux å®˜æ–¹æ‰æœ‰è½¯ä»¶åŒ…ç®¡ç†å·¥å…·ï¼Œå¾®è½¯å®˜æ–¹ä¹Ÿä¸º Windows ç³»ç»Ÿå‘å¸ƒäº†ä¸€æ¬¾åä¸º [winget](https://docs.microsoft.com/en-us/windows/package-manager/winget/)çš„è½¯ä»¶åŒ…ç®¡ç†å·¥å…·ï¼ŒåŒ…ç®¡ç†å™¨åœ¨å„ç§ç³»ç»Ÿè½¯ä»¶å’Œåº”ç”¨è½¯ä»¶çš„å®‰è£…ç®¡ç†ä¸­å‡æœ‰å¹¿æ³›åº”ç”¨ã€‚

## **npm** **ã€cnpmã€** **yarn** **ã€** **pnpm** **ä¸»è¦åŒºåˆ«**

### npm ç®€ä»‹

> npm is the standard package manager for Node.js.

npm æ˜¯ Node Package Manager çš„ç®€ç§°ï¼Œäº2010å¹´å‘å¸ƒï¼Œæ˜¯ Node.js ç¤¾åŒºæœ€æµè¡Œçš„ä¸€ä¸ªåŒ…ç®¡ç†å·¥å…·ï¼Œå½“ä½ å®‰è£… Node.jsçš„åŒæ—¶ä¹Ÿä¼šé»˜è®¤å®‰è£… npm.

npm ä¸»è¦åŒ…æ‹¬ä¸¤éƒ¨åˆ†:

- Online platform: å¯ä»¥ä¸Šä¼ åˆ†äº« JavaScript package åŒ…
- Command line tool:
  - å®‰è£…å’Œå¸è½½ package åŒ…
  - ç‰ˆæœ¬æ§åˆ¶
  - ä¾èµ–ç®¡ç†ç­‰

- npm æº
  - æ¥å£
  - æ•°æ®åº“

npm å¤§è‡´çš„ç»„æˆç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![](https://assets.wuxinhua.com/blog/assets/npm/api.svg)

ä¸»è¦å‘å±•å†å²ï¼š

- æ˜¯ nodejs é»˜è®¤çš„è½¯ä»¶åŒ…ç®¡ç†ç³»ç»Ÿï¼Œæˆç«‹æ—¶é—´æ¯”è¾ƒæ—©ï¼Œæˆªæ­¢2016å¹´ npmçš„registryä¸Šé¢å·²ç»æ³¨å†Œäº†è¶…è¿‡280,000ä¸ªæ¨¡å—
- npm2 ç‰ˆæœ¬ç”±äºåµŒå¥—æ–‡ä»¶æ¨¡å¼ï¼Œå¤§é‡é‡å¤çš„ä¾èµ–é¡¹ä¼šå­˜å‚¨åœ¨ç¥å¥‡çš„ node_modules å†…
- å®‰è£…é€Ÿç‡æœ‰ä¸€å®šå±€é™ï¼Œnpm æ˜¯æŒ‰ç…§é˜Ÿåˆ—æ‰§è¡Œæ–¹å¼æ¥å®‰è£… package çš„ï¼Œä¹Ÿå°±æ˜¯è¯´å½“å‰packageå®‰è£…å®Œåæ‰èƒ½ç»§ç»­åé¢çš„å®‰è£…
- [2016 left-pad äº‹ä»¶](https://www.zhihu.com/question/41694868)
- Yarn å‘å¸ƒï¼Œnpm éšåä¹Ÿå‘å¸ƒ [shrinkwrap](https://docs.npmjs.com/cli/v7/commands/npm-shrinkwrap) ï¼Œnpm 5 æ–°åŠ å…¥ package-lock.json é”å®šæ–‡ä»¶
- 2020 Github æ­£å¼æ”¶è´­ npm

#### cnpm

cnpm çš„å‘½ä»¤åŸºæœ¬å’Œ npm ä¸€æ ·ï¼Œç”±äº npmjs çš„æœåŠ¡å™¨åœ¨å›½å¤–ï¼Œæ‰€ä»¥å›½å†…å¼€å‘è€…åœ¨åšé¡¹ç›®ä¸‹è½½ä¾èµ–åŒ…çš„æ—¶å€™ï¼Œä¸‹è½½é€Ÿç‡æ¯”è¾ƒæ…¢ï¼Œåœ¨è¿™ç§èƒŒæ™¯ä¸‹ï¼Œé˜¿é‡Œå›¢é˜Ÿæ¨å‡ºäº† cnpmï¼Œå®ƒæ˜¯æ˜¯ä¸€ä¸ªå®Œæ•´çš„ npmjs é•œåƒï¼Œç›®å‰çš„åŒæ­¥é¢‘ç‡çš„ 10 åˆ†é’Ÿä¸€æ¬¡ä¿è¯å’Œå®˜æ–¹æœåŠ¡ä¿æŒä¸€è‡´ï¼Œç§æœ‰æºçš„å¥½å¤„ï¼š

- ç½‘ç»œè®¿é—®ç¨³å®šæ€§ï¼Œå®‰è£…é€Ÿç‡ä¼šæœ‰è¾ƒå¤§å¹…åº¦çš„æå‡
- å†…éƒ¨æ­å»ºç§æœ‰æºç‰ˆæœ¬æ˜¯å¯æ§çš„ï¼Œ å³ä½¿å‡ºç°çº¿ä¸Šé—®é¢˜ï¼Œå¯ä»¥é€šè¿‡åˆ é™¤æœ‰é—®é¢˜çš„æ¨¡å—ç‰ˆæœ¬ï¼Œæˆ–è€…æ˜¯é€šè¿‡é‡æ–°è®¾ç½® latest tag çš„æ–¹å¼è®©æœ‰é—®é¢˜çš„æ¨¡å—ä¸å†è¢«å®‰è£…åˆ°

#### Yarn

> Safe, stable, reproducible projects

Yarn æ˜¯ä¸€ä¸ªå¿«é€Ÿå¯é å®‰å…¨çš„ä¾èµ–ç®¡ç†å·¥å…·ï¼Œç”± Facebook è”åˆå…¶å®ƒå‡ ä¸ªäº’è”ç½‘å…¬å¸ä¸»å¯¼çš„ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œç›®å‰ç¨³å®šç‰ˆæœ¬ 1.22.4 ï¼Œyarn çš„ä¸€äº›ç‰¹ç‚¹ï¼š

- é€Ÿåº¦å¿«ï¼Œyarn ç¼“å­˜ä¹‹å‰ä¸‹è½½è¿‡çš„åŒ…ï¼Œæ— éœ€é‡å¤ä¸‹è½½
- é”æ–‡ä»¶æ ¼å¼ï¼Œä¿è¯ä¸åŒç³»ç»Ÿæ— å·®åˆ«å·¥ä½œ

åœ¨ focebook å·¥ç¨‹å›¢é˜Ÿçš„[ä»‹ç»](https://engineering.fb.com/2016/10/11/web/yarn-a-new-package-manager-for-javascript/)ä¸­å¯ä»¥äº†è§£åˆ°ä¸ºä»€ä¹ˆä¼šåˆ›ä½œæ–°çš„åŒ…ç®¡ç†å·¥å…·æ¥æ›¿ä»£ npm:

- npm install å¾ˆæ…¢ï¼Œåˆ é™¤ node_modules å†å®‰è£…ä¹Ÿå¾ˆæ…¢
- åŒä¸€ä¸ªé¡¹ç›®å®‰è£…æ— æ³•ä¿è¯ä¸€è‡´æ€§ï¼Œä¾‹å¦‚ä½¿ç”¨çš„æ˜¯ç›¸åŒçš„ package.json`^0.1.1`åœ¨å®‰è£…æ—¶ä¼šå‡ºç°é—®é¢˜ï¼Œå¯èƒ½ä¼šæ‹‰å–åˆ°ä¸åŒç‰ˆæœ¬çš„åŒ…ï¼Œå¯¼è‡´åœ¨ç›¸åŒçš„ç¯å¢ƒä¸­æœ‰çš„åŒäº‹èƒ½æ­£å¸¸è¿è¡Œæœ‰çš„ä¸èƒ½

ä¸Šé¢æåˆ°è¿‡äº†ï¼Œä¸åŒäº npm çš„å®‰è£…æ–¹å¼ï¼Œyarnçš„å®‰è£…æ˜¯åŒæ­¥æ‰§è¡Œä»»åŠ¡ï¼Œè¿™æ ·æ€§èƒ½æ•ˆç‡æœ‰è¾ƒå¤§æå‡ï¼›npm å’Œ Yarn éƒ½æ˜¯é€šè¿‡ package.json è®°å½•é¡¹ç›®éœ€è¦æ‹‰å–çš„ä¾èµ–æ¨¡å—ï¼Œä¸ºäº†é˜²æ­¢æ‹‰å–åˆ°ä¸åŒçš„ç‰ˆæœ¬ï¼Œyarn æœ‰ä¸€ä¸ªé”å®šæ–‡ä»¶ (lock file) è®°å½•äº†è¢«ç¡®åˆ‡å®‰è£…ä¸Šçš„æ¨¡å—çš„ç‰ˆæœ¬å·ã€‚æ¯æ¬¡åªè¦æ–°å¢äº†ä¸€ä¸ªæ¨¡å—ï¼Œyarn å°±ä¼šåˆ›å»ºï¼ˆæˆ–æ›´æ–°ï¼‰yarn.lock è¿™ä¸ªæ–‡ä»¶ã€‚è¿™ä¹ˆåšå°±ä¿è¯äº†ï¼Œæ¯ä¸€æ¬¡æ‹‰å–åŒä¸€ä¸ªé¡¹ç›®ä¾èµ–æ—¶ï¼Œä½¿ç”¨çš„éƒ½æ˜¯ä¸€æ ·çš„æ¨¡å—ç‰ˆæœ¬

åŒ npm çš„ä¸€äº›åŒºåˆ«ï¼š

- npm éš Node.js è‡ªåŠ¨å®‰è£…ï¼Œyarn éœ€è¦æ‰‹åŠ¨å®‰è£… npm install yarn --global

- npm å®‰è£…æ—¶éœ€è¦ç½‘ç»œï¼Œyarn å¯ä»¥ä» cache ä¸­å®‰è£…

- CLI æ–¹é¢ yarn æ‹¥æœ‰æ›´ç®€æ´çš„å‘½ä»¤

- åŒ…ç‰ˆæœ¬æ–¹é¢ npmæ˜¯å¼±ç»‘å®šçš„ï¼Œè€Œyarnåˆ™æ˜¯å¼ºç»‘å®šçš„ï¼Œç¡®ä¿ä¸åŒæœºå™¨ç¯å¢ƒä¸‹å®‰è£…çš„ç‰ˆæœ¬æ˜¯ä¸€è‡´çš„

- PnPç‰¹å¾è§£å†³æ•ˆç‡é—®é¢˜ï¼Œåœ¨åé¢ä¼šæåˆ° install å®‰è£…çš„å‡ ä¸ªæ­¥éª¤ï¼š

    1.å°†ä¾èµ–åŒ…çš„ç‰ˆæœ¬åŒºé—´è§£æä¸ºæŸä¸ªå…·ä½“çš„ç‰ˆæœ¬å·
    2.ä¸‹è½½å¯¹åº”ç‰ˆæœ¬ä¾èµ–çš„ tar åŒ…åˆ°æœ¬åœ°ç¦»çº¿é•œåƒ
    3.å°†ä¾èµ–ä»ç¦»çº¿é•œåƒè§£å‹åˆ°æœ¬åœ°ç¼“å­˜
    4.å°†ä¾èµ–ä»ç¼“å­˜æ‹·è´åˆ°å½“å‰ç›®å½•çš„ node_modules ç›®å½•ï¼Œ

åœ¨ç¬¬å››æ­¥ä¸­æ¶‰åŠåˆ°å¤§é‡çš„ I/O æ“ä½œï¼ŒPnP çš„æ–¹æ¡ˆå°±æ˜¯çœç•¥ç¬¬å››æ­¥ï¼Œé€šè¿‡ä¸€ä¸ª.pnp.js çš„æ–‡ä»¶æ¥è®°å½•ä¾èµ–æ˜ å°„å…³ç³»ã€è¿™äº›åŒ…å…·ä½“ä½ç½®ï¼Œè¿™æ ·å°±ä¸å†æ‹·è´æ–‡ä»¶åˆ°å…·ä½“ node_modulesç›®å½•é‡Œï¼Œå…³äº Yarn 2.0 pnp ç‰¹å¾å¯ä»¥å‚è€ƒ [è¿™ç¯‡æ–‡ç« ](https://loveky.github.io/2019/02/11/yarn-pnp/)

#### pnpm

> Fast, disk space efficient package manager

ä»€ä¹ˆæ˜¯ pnpm ? å®˜æ–¹æ–‡æ¡£æ˜¯ä¸Šé¢è¿™æ ·ä»‹ç»çš„ï¼Œæœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ä¸ªåŒ…ç®¡ç†å™¨ï¼Œä»ä»‹ç»æ¥çœ‹æœ‰ä¸¤å¤§ä¼˜åŠ¿ï¼Œå¿«å’ŒèŠ‚çœç£ç›˜ç©ºé—´ï¼Œæ¦‚æ‹¬ä¸‹ï¼š

- æ‰€æœ‰æ–‡ä»¶éƒ½ä¿å­˜åœ¨ç¡¬ç›˜ä¸Šçš„ç»Ÿä¸€çš„ä½ç½®ï¼Œå½“å®‰è£…è½¯ä»¶åŒ…æ—¶ï¼Œ å…¶åŒ…å«çš„æ‰€æœ‰æ–‡ä»¶éƒ½ä¼šç¡¬é“¾æ¥è‡ªæ­¤ä½ç½®ï¼Œè€Œä¸ä¼šå ç”¨é¢å¤–çš„ç¡¬ç›˜ç©ºé—´ï¼Œé¡¹ç›®ä¹‹é—´æ–¹ä¾¿åœ°å…±äº«ç›¸åŒç‰ˆæœ¬çš„ä¾èµ–åŒ…ï¼Œä¾‹å¦‚ä½¿ç”¨ npm æˆ– Yarn æ—¶ï¼Œå¦‚æœä½ æœ‰ 100 ä¸ªé¡¹ç›®ï¼Œå¹¶ä¸”æ‰€æœ‰é¡¹ç›®éƒ½æœ‰ä¸€ä¸ªç›¸åŒçš„ä¾èµ–åŒ…ï¼Œé‚£ä¹ˆä½ åœ¨ç¡¬ç›˜ä¸Šå°±éœ€è¦ä¿å­˜ 100 ä»½è¯¥ç›¸åŒä¾èµ–åŒ…çš„å‰¯æœ¬
- è§£å†³å®‰å…¨é—®é¢˜ï¼Œä¸ Yarn ä¸€æ ·ï¼Œpnpm æœ‰ä¸€ä¸ªåŒ…å«æ‰€æœ‰å·²å®‰è£…åŒ…æ ¡éªŒå’Œçš„ç‰¹æ®Šæ–‡ä»¶ï¼Œç”¨äºåœ¨æ‰§è¡Œä»£ç ä¹‹å‰éªŒè¯æ¯ä¸ªå·²å®‰è£…åŒ…çš„å®Œæ•´æ€§
- æ”¯æŒç¦»çº¿æ¨¡å¼ï¼Œpnpm å°†æ‰€æœ‰ä¸‹è½½çš„åŒ… tarball ä¿å­˜åœ¨æœ¬åœ°æ³¨å†Œè¡¨é•œåƒä¸­ã€‚å½“åŒ…åœ¨æœ¬åœ°å¯ç”¨æ—¶ï¼Œå®ƒä»ä¸å‘å‡ºè¯·æ±‚ã€‚ä½¿ç”¨è¯¥`--offline`å‚æ•°å¯ä»¥å®Œå…¨ç¦æ­¢ HTTP è¯·æ±‚
- é€Ÿåº¦ä¸Špnpm æ¯” npm å¿«ï¼Œè€Œä¸”æ¯” Yarn å¿«ï¼ŒYarn ä»ç¼“å­˜ä¸­å¤åˆ¶æ–‡ä»¶ï¼Œè€Œ pnpm åªæ˜¯ä»å…¨å±€å­˜å‚¨ä¸­è¿›è¡Œé“¾æ¥

å®‰è£…é€Ÿç‡å¯¹æ¯”ï¼Œä»¥è¿™ä¸ª[ä»“åº“](https://github.com/pnpm/benchmarks-of-javascript-package-managers)ä¸ºä¾‹ï¼Œ ä¸»è¦å¯¹æ¯”ä¸€ä¸‹ `pnpm`å’Œ `yarn PnP`

![](https://assets.wuxinhua.com/blog/assets/npm/npm.png)

å›¾ç‰‡æ¥æºï¼ˆ[ä¸ºä»€ä¹ˆç°åœ¨æˆ‘æ›´æ¨è pnpm è€Œä¸æ˜¯ npm/yarn?](https://juejin.cn/post/6932046455733485575#heading-0)ï¼‰

### åŒºåˆ«

- npm cnpm yarn pnpm å‡æ˜¯ Node çš„ä¾èµ–ç®¡ç†å·¥å…·ï¼Œç›®å‰ä½¿ç”¨èŒƒå›´ã€æµè¡Œåº¦ï¼š npm > yarn > cnpm > pnpm

- npm ä½¿ç”¨ package.json çš„æ–‡ä»¶ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡ npm install å‘½ä»¤æŠŠé¡¹ç›®é‡Œæ‰€æœ‰çš„ä¾èµ–é¡¹ä¿å­˜åœ¨è¿™ä¸ªæ–‡ä»¶é‡Œï¼Œå®‰è£…ä¾èµ–æ˜¯ä»å›½å¤–æœåŠ¡å™¨ä¸‹è½½ï¼Œå—ç½‘ç»œå½±å“æ¯”è¾ƒå¤§ï¼Œcnpm å®‰è£…æ–¹å¼å’Œå‘½ä»¤å’Œ npm å®Œå…¨ä¸€è‡´ï¼Œä½†æœåŠ¡å™¨åœ¨å›½å†…ï¼Œæ‰€ä»¥ä¸å—ç½‘ç»œå½±å“ï¼Œæ­å»ºç§æœ‰æºç›¸å¯¹ç¨³å®šæ€§ä¼šæœ‰è¾ƒå¤§æé«˜

- Yarn æ˜¯é‡æ–°è®¾è®¡çš„ä¸€ä¸ªæ–°çš„åŒ…ç®¡ç†å·¥å…·ï¼Œé€Ÿåº¦ä¸Šæœ‰è¾ƒå¤§çš„æå‡ï¼Œ

  - ææµ‹ lock é”åŒ…æ¨¡å¼ï¼Œè§£å†³ npm åœ¨ä¸åŒç¯å¢ƒå®‰è£…æ—¶åŒ…ä¸ä¸€è‡´å¯¼è‡´çš„é—®é¢˜
  - ä½¿ç”¨æœ¬åœ°ç¼“å­˜ï¼Œä¸ yarn ä¸ä¸€è‡´çš„æ˜¯ yarn æä¾›äº†ä¸€ä¸ªç¦»çº¿æ¨¡å¼ä¹Ÿå°±æ˜¯ä¸éœ€è¦è”ç½‘çŠ¶æ€ä¹Ÿèƒ½æ­£å¸¸å®‰è£…
  - è§£å†³äº†å®‰è£…é€Ÿç‡é—®é¢˜
  - ç®€åŒ–äº†ä¸€äº›é…ç½®æ–‡ä»¶

- pnpm ç›¸å¯¹äºå…¶å®ƒå‡ ä¸ªåŒ…ç®¡ç†è½¯ä»¶å…·æœ‰ä»¥ä¸‹å‡ ä¸ªç‰¹åˆ«ï¼š

  - é€Ÿåº¦å¿«å¹¶ä¸”èŠ‚çº¦ç£ç›˜ç©ºé—´
  - æ”¯æŒ monorepo (æä¾›å­å‘½ä»¤ï¼Œä¾‹å¦‚æ ¹ç›®å½•ä¸‹ `pnpm add A -r`, é‚£ä¹ˆæ‰€æœ‰çš„ package ä¸­éƒ½ä¼šè¢«æ·»åŠ  A è¿™ä¸ªä¾èµ–)
  - æå‡å®‰å…¨æ€§ï¼Œè‡ªåˆ›äº†ä¸€å¥—ä¾èµ–ç®¡ç†æ–¹å¼ï¼Œè§£å†³éæ³•è®¿é—®ï¼ˆ node_module çš„æ‰å¹³ç»“æ„ï¼Œå¦‚æœ A ä¾èµ– Bï¼Œ B ä¾èµ– Cï¼Œé‚£ä¹ˆ A å½“ä¸­æ˜¯å¯ä»¥ç›´æ¥ä½¿ç”¨ C çš„ï¼Œä½†é—®é¢˜æ˜¯ A å½“ä¸­å¹¶æ²¡æœ‰å£°æ˜ C è¿™ä¸ªä¾èµ–ã€‚å› æ­¤ä¼šå‡ºç°è¿™ç§éæ³•è®¿é—®çš„æƒ…å†µï¼‰çš„é—®é¢˜ï¼Œä¿è¯å®‰å…¨æ€§ã€‚

- ä¸‹è½½é€Ÿåº¦å¯¹æ¯”ï¼Œpnpm > yarn > npm

![](https://assets.wuxinhua.com/blog/assets/npm/npm.png)

## lock æ–‡ä»¶

åœ¨ç‰ˆæœ¬ 5 ä¸­ï¼Œnpm å¼•å…¥äº† `package-lock.json` æ–‡ä»¶ï¼Œè¿™ä¸ªåŠŸèƒ½å…¶å®æ˜¯æ¥å— yarn çš„ä¸€ä¸ªç‰¹å¾ï¼Œæ ¸å¿ƒçš„ç›®çš„æ˜¯è·Ÿè¸ªè¢«å®‰è£…çš„æ¯ä¸ªè½¯ä»¶åŒ…çš„ç¡®åˆ‡ç‰ˆæœ¬ï¼Œä»¥ä¾¿äº§å“å¯ä»¥ä»¥ç›¸åŒçš„æ–¹å¼è¢« 100ï¼… å¤åˆ¶ï¼ˆå³ä½¿è½¯ä»¶åŒ…çš„ç»´æŠ¤è€…æ›´æ–°äº†è½¯ä»¶åŒ…ï¼‰ã€‚

### package-lock.json

![](https://assets.wuxinhua.com/blog/assets/npm/package.json.png)

### ä¸ºä»€ä¹ˆä¼šéœ€è¦è¿™ä¸ªlock æ–‡ä»¶ï¼Ÿ

- ä¸¾ä¸ªç®€å•çš„ğŸŒ° åœ¨ package.json ä¸­æ·»åŠ ä¸€æ¡è®°å½•ï¼Œ react ç‰ˆæœ¬ä¸º ^17.0.0ï¼Œå°†ä¼šå®‰è£…æœ€æ–°ç‰ˆ 17.0.2ã€‚å¦‚æœæ”¹æˆ ^16.0.0 ç‰ˆæœ¬é‚£ä¹ˆå®‰è£…çš„å°†æ˜¯ 16.14.0ï¼Œä¹Ÿå°±æ˜¯ 16 å¤§ç‰ˆæœ¬å·ä¸­èƒ½å®‰è£…çš„æœ€æ–°ç‰ˆæœ¬ï¼Œä¹Ÿå°±æ˜¯è¯´package.json æ–‡ä»¶åªèƒ½é”å®šå¤§ç‰ˆæœ¬
- ç”±äº package.json å‘åï¼ˆæ–°ï¼‰å…¼å®¹çš„æœºåˆ¶ï¼Œèƒ½ç¡®ä¿æˆ‘ä»¬æ€»æ˜¯èƒ½å®‰è£…åˆ°æœ€æ–°çš„åŒ…ï¼Œä½†è¿™æ ·ä¹Ÿå¸¦æ¥ä¸€äº›é—®é¢˜ï¼Œå½“ä½ æ¢äº†æœºå™¨æˆ–ä¸‹è½½æºï¼Œæˆ–è€…ç›®æ ‡åº“ç‰ˆæœ¬å·æœ‰æ›´æ–°æ—¶æœ‰å¯èƒ½ä¼šå¯¼è‡´åŒä¸€ä¸ªé¡¹ç›®ä¸‹è½½çš„åŒ…ç‰ˆæœ¬ä¸ä¸€è‡´å¸¦æ¥æ–°çš„é—®é¢˜ï¼Œè¿™ä¹Ÿæ˜¯`package-lock.json` è¢«åˆ›å»ºå‡ºæ¥çš„åŸå› ï¼Œlock æ–‡ä»¶ä¼šè®°å½•å½“å‰å®‰è£…çš„æ¯ä¸ªè½¯ä»¶åŒ…çš„ç‰ˆæœ¬ï¼Œå½“è¿è¡Œ `npm install`æ—¶ï¼Œ`npm` ä¼šä½¿ç”¨è¿™äº›ç¡®åˆ‡çš„ç‰ˆæœ¬ã€‚
- å¦‚æœä¸¤è€…ç‰ˆæœ¬ä¸ä¸€è‡´æ—¶ï¼Œä¾‹å¦‚æ”¹äº†package.json lockæ–‡ä»¶æ²¡æœ‰æ›´æ–°ï¼Œä¸” package.jsonå’Œ lock æ–‡ä»¶ä¸åŒï¼Œé‚£ä¹ˆæ‰§è¡Œ`npm i`æ—¶ npm ä¼šæ ¹æ®packageä¸­çš„ç‰ˆæœ¬å·ä»¥åŠè¯­ä¹‰å«ä¹‰å»ä¸‹è½½æœ€æ–°çš„åŒ…ï¼Œå¹¶æ›´æ–°è‡³lockã€‚å¦‚æœä¸¤è€…æ˜¯åŒä¸€çŠ¶æ€ï¼Œé‚£ä¹ˆæ‰§è¡Œ`npm i`éƒ½ä¼šæ ¹æ®l ockä¸‹è½½ï¼Œä¸ä¼šç†ä¼špackageå®é™…åŒ…çš„ç‰ˆæœ¬æ˜¯å¦æœ‰æ–°ã€‚

### æ˜¯å¦éœ€è¦å°† lock æ–‡ä»¶å†™è¿› .gitignore

[jquery åŠ ä¸Šäº†ï¼Œvue](https://github.com/vuejs/vue) åˆ™æ²¡æœ‰å†™å…¥åˆ° gitignoreä¸­ ï¼Œæ–°å¢ä¸¤ä¸ªè®¨è®ºé¡¹ï¼Œç›¸å…³è®¨è®ºé“¾æ¥ï¼š

- [package-lock.json éœ€è¦å†™è¿› .gitignore å—ï¼Ÿ](https://www.zhihu.com/question/264560841)
- [ä¸ºä»€ä¹ˆæˆ‘ä¸ä½¿ç”¨ shrinkwrapï¼ˆlockï¼‰](https://zhuanlan.zhihu.com/p/22934066)

## npm install åå‘ç”Ÿäº†ä»€ä¹ˆ?

è¿™ä¸ªé—®é¢˜ç±»ä¼¼äºâ€œåœ¨æµè§ˆå™¨è¾“å…¥ url å›è½¦ä¹‹åå‘ç”Ÿäº†ä»€ä¹ˆâ€ æˆ–è€…â€œå¦‚ä½•æ‰‹åŠ¨å®ç°ä¸€ä¸ª npm installâ€ï¼Œä¾èµ–å®‰è£…ç®¡ç†æ˜¯ npm çš„æ ¸å¿ƒåŠŸèƒ½ï¼ŒåŸç†å°±æ˜¯æ‰§è¡Œ `npm install` ä» package.json ä¸­çš„ dependencies ä¾èµ–åŒ…å®‰è£…åˆ°å½“å‰ç›®å½•çš„ ./node_modules æ–‡ä»¶å¤¹ä¸­ï¼Œæˆ‘ä»¬ä»¥å®‰è£… express ä¸ºä¾‹æˆ‘ä»¬æ¥æ¢è®¨ä¸€ä¸‹å®ƒçš„å®‰è£…æµç¨‹

```sh
npm install express --timing=true --loglevel=verbose
```

é€šè¿‡ä¸Šé¢çš„è¿™ä¸ªå‘½ä»¤å¯ä»¥åœ¨å‘½ä»¤è¡ŒåŠlogæ—¥å¿—é‡Œçœ‹åˆ°æ•´ä¸ªå®‰è£…è¿‡ç¨‹ï¼Œå¤§è‡´çš„æµç¨‹å¦‚ä¸‹ï¼š

![](https://assets.wuxinhua.com/blog/assets/npm/npm_install.png)

### preinstall

å¦‚æœå·¥ç¨‹æœ‰å®šä¹‰ preinstall é’©å­ï¼Œé‚£åœ¨å®‰è£…å‰ä¼šé’©å­å†…å®¹ä¼šè¢«æ‰§è¡Œ

### æ£€æŸ¥ config

- ä¾‹å¦‚å¦‚æœä½¿ç”¨ --registry æ³¨å†Œæºç›®å½•

- Check é¡¹ç›®ç›®å½•ä¸­çš„ .npmrc æ–‡ä»¶ï¼Œå…³äº npmrc æ–‡ä»¶åŠä¼˜å…ˆçº§

- é¡¹ç›®çº§ .npmrc æ–‡ä»¶ > ç”¨æˆ·çº§ > å…¨å±€ > npm å†…ç½®

- é™¤äº†é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„ npmrc æ–‡ä»¶å¤–ï¼Œåœ¨ä½ çš„å¼€å‘ç¯å¢ƒä¸­åº”è¯¥å­˜åœ¨å¤šä¸ª .npmrc æ–‡ä»¶ï¼Œä¾‹å¦‚ç”¨æˆ·é…ç½® npmrc æ–‡ä»¶å¯ä»¥é€šè¿‡ `npm config get userconfig`ï¼Œå¦‚æœä¸€å°ç”µè„‘æœ‰å¤šä¸ªç”¨æˆ·ï¼Œé€šè¿‡é€šè¿‡ prefix å‰ç¼€é…ç½®å…¨å±€çš„ npmrc æ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡ `npm config get prefix` æ¥è·å–é…ç½®ä¿¡æ¯

- å†…ç½® npmrc æ–‡ä»¶ç”¨çš„ä¸å¤šï¼ŒåŸºæœ¬ä¸éœ€è¦å…³æ³¨ï¼Œå¯ä»¥é€šè¿‡`npm config list` æ¥æŸ¥çœ‹ npm çš„é…ç½®

- æœ‰ä¸¤ç§æ–¹å¼è®¾ç½®ï¼Œä¾‹å¦‚è®¾ç½®æ·˜å®ä»“åº“æºï¼š
  - npm å‘½ä»¤ï¼Œä¾‹å¦‚ npm config set registry <https://registry.npm.taobao.org>
  - .npmrc æ–‡ä»¶å†…å†™å…¥`registry=https://registry.npm.taobao.org`

### æ£€æŸ¥ lockfile

- æ£€æŸ¥é¡¹ç›®ä¸­æ˜¯å¦æœ‰ package-lock.json æ–‡ä»¶ï¼Œå­˜åœ¨è¯»å– lock æ–‡ä»¶é‡ŒåŒ…çš„ç‰ˆæœ¬ä¿¡æ¯ï¼Œæ— åˆ™è·³åˆ° 4æ­¥éª¤æ„å»ºä¸€ä¸ªä¾èµ–æ ‘ã€‚ä» npm 5.x ç‰ˆæœ¬å¼€å§‹ä¸å­˜åœ¨ npm ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ª package-lock.json æ–‡ä»¶ï¼Œæ³¨æ„è¿™ä¸ªæ­¥éª¤æ˜¯åœ¨æœ€åä¸€æ­¥å¤„ç†çš„

- æ£€æŸ¥å’Œ package.json ç‰ˆæœ¬æ˜¯å¦å†²çªï¼Œå†²çªæƒ…å†µï¼ˆnpm v5 ç‰ˆæœ¬åä¸ºä¾‹ï¼‰ï¼š

  - æ—  package-lock.json æ ¹æ® package.json å®‰è£…ï¼Œæœ€åç”Ÿæˆ lock æ–‡ä»¶
  - package.json å’Œ package-lock.json çš„ç‰ˆæœ¬ä¸å…¼å®¹ï¼Œä½¿ç”¨ npm i å‘½ä»¤ä»¥ package.jsonä¸ºå‡†
  - package.json å’Œ package-lock.jsonçš„ç‰ˆæœ¬å…¼å®¹ï¼Œä½¿ç”¨ npm i å‘½ä»¤ ä»¥ package-lock.json ä¸ºå‡†

### æ„å»ºåŒ…çš„ä¾èµ–æ ‘

æ—  lock æ–‡ä»¶çš„æƒ…å†µä¸‹ï¼Œä» npm è¿œç¨‹ä»“åº“è·å–åŒ…ä¿¡æ¯ï¼Œæ ¹æ® package.json æ„å»ºä¸€ä¸ªä¾èµ–æ ‘ï¼Œæ„å»ºä¾èµ–æ ‘å¹¶éçœŸæ­£æ„ä¹‰çš„å®‰è£…ï¼Œåç»­å®‰è£…çš„æ—¶å€™ä¼šæ ¹æ®è¿™ä¸ªç»“æ„å»ç¼“å­˜ä¸­è·å–æˆ–æ ¹æ®åœ°å€å»è¿œç¨‹ä»“åº“ä¸‹è½½ï¼Œä» v3 ç‰ˆæœ¬å¼€å§‹ npm é‡‡ç”¨æ‰å¹³åŒ–ç»“æ„å­˜å‚¨åŒ…ï¼Œä¸ç®¡æ˜¯ç›´æ¥ä¾èµ–è¿˜æ˜¯å­ä¾èµ–ä¼˜å…ˆæ”¾ç½®åœ¨ node_modules æ ¹ç›®å½•

### æ£€æŸ¥ç¼“å­˜

- æœ‰ç¼“å­˜ç›´æ¥è§£å‹åˆ° node_modules
- æ— åˆ™å»ä¸‹è½½åŒ…ï¼Œä¸‹è½½åæ ¡éªŒåŒ…çš„å®Œæ•´æ€§ï¼Œæ ¡éªŒä¸é€šè¿‡ä¼šé‡æ–°ä¸‹è½½ï¼Œé€šè¿‡åä¼š copy è‡³ npm ç¼“å­˜ç›®å½•ä¸‹ï¼Œå†å°†åŒ…è§£å‹è‡³ node_modulesï¼Œå…³äºç¼“å­˜å¯ä»¥é€šè¿‡ `npm config get cache` è·å–åˆ°å­˜æ”¾åœ°å€ï¼Œä¸€èˆ¬ä¼šå­˜æ”¾åœ¨ /Users/username/.npm æ–‡ä»¶å¤¹ä¸‹

ä¸Šé¢æåˆ°äº†å…³äºåŒ…çš„å®Œæ•´æ€§æ ¡éªŒï¼Œæ¥çœ‹ä¸‹ npm æ€ä¹ˆæ¥åšè¿™ä¸ªå®Œæ•´æ€§æ ¡éªŒçš„ï¼Œåœ¨ä¸‹è½½å‰æ˜¯èƒ½æ‹¿åˆ° npm ä»“åº“åŒ…æ–‡ä»¶è®¡ç®—çš„ hash å€¼ï¼Œæ‹¿ react ä¸ºä¾‹æˆ‘ä»¬å¯ä»¥é€šè¿‡ npm info å‘½ä»¤æŸ¥çœ‹ hash å€¼ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œä¸ºäº†ç¡®ä¿ä¸‹è½½åçš„æ–‡ä»¶ä¸€è‡´ï¼Œnpm ä¼šåœ¨ä¸‹è½½å®Œæˆåæœ¬åœ°è®¡ç®—ä¸€ä¸‹æ–‡ä»¶çš„ hash ï¼Œç›¸åŒåˆ™è¯´æ˜ä¸‹è½½æ˜¯æˆåŠŸï¼Œå¦åˆ™ä¼šé‡æ–°ä¸‹è½½

![](https://assets.wuxinhua.com/blog/assets/npm/npm-react.png)

### ç”Ÿæˆlockæ–‡ä»¶

ç”Ÿæˆä¸€ä»½lockæ–‡ä»¶ï¼Œé”å®šåŒ…çš„ç‰ˆæœ¬ï¼Œå®Œæˆæ•´ä¸ªä¸‹è½½å®‰è£…æµç¨‹

## Why node_modules are so heavy ?

![](https://assets.wuxinhua.com/blog/assets/npm/node_module_haviy.png)

åœ¨ jsconf.eu å¤§ä¼šä¸Šï¼ŒRyan Dahl çš„æ¼”è®² [Node.js åå¤§è®¾è®¡ç¼ºé™· - Ryan Dahl - JSConf EU](https://www.youtube.com/watch?v=M3BM9TB-8yA&t=1184s) ä¸­æåˆ°äº† node_modules åœ¨è®¾è®¡ä¸Šçš„é—®é¢˜ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨ npm install åå¯èƒ½è¦ç­‰å¾ˆä¹…ï¼Œç„¶åä¼šå‘ç°ç¨‹åºä¸‹è½½äº†å¾ˆå¤§ä½“ç§¯çš„ node_modules æ–‡ä»¶ï¼Œè¿™ä¸»è¦æ˜¯å› ä¸º Node çš„ vendored-by-default æœºåˆ¶ï¼Œä¼šä»¤ node_module ä¸»åŠ¨åœ°å®‰è£…æ‰€æœ‰ module çš„ dependencies

### Dependency Hell

æ—©æœŸçš„ npm v2 ç®¡ç†æ¨¡å—ä¾èµ–çš„æ–¹å¼æ¯”è¾ƒç®€å•ï¼Œå®ƒè¯»å–æ¯ä¸ªæ¨¡å—çš„ä¾èµ–åˆ—è¡¨å³ package.json æ–‡ä»¶ï¼Œå¹¶ä¸‹è½½ä¾èµ–åˆ°è¯¥æ¨¡å—ç›®å½•å†…çš„ `node_modules` ä¸‹ï¼›å¦‚æœè¯¥ä¾èµ–åˆä¾èµ–äº†å…¶ä»–çš„æ¨¡å—ï¼Œä¼šç»§ç»­ä¸‹è½½ä¾èµ–åˆ°è¯¥æ¨¡å—ç›®å½•çš„ `node_modules` æ–‡ä»¶å¤¹ä¸‹ï¼Œå¦‚æ­¤é€’å½’æ‰§è¡Œä¸‹å»ï¼Œæœ€ç»ˆå½¢æˆä¸€é¢—åºå¤§çš„ä¾èµ–æ ‘ï¼Œå¤§è‡´çš„ç»“æ„å¦‚ä¸‹ï¼š

![](https://assets.wuxinhua.com/blog/assets/npm/dependecy_hell.png)

è¿™æ ·å®‰è£…ä¹Ÿå¸¦æ¥ä¸€äº›é—®é¢˜ï¼š

- ä½“ç§¯å˜å¾—éå¸¸å¤§ï¼Œå› ä¸ºæœ‰å¯èƒ½å­˜åœ¨åŒç‰ˆæœ¬çš„ä¾èµ–ï¼Œåˆ†å¸ƒåœ¨ä¸åŒçš„ `node_modules` æ–‡ä»¶å¤¹å†…
- å®é™…ä¸Šé‡å¤çš„èµ„æºä¹Ÿä¼šå ç”¨å¤§é‡çš„ç”µè„‘ç£ç›˜èµ„æº
- ç”±äºä¾èµ–æ ‘çš„å±‚çº§éå¸¸æ·±ï¼Œç›®å½•å±‚çº§æ·±å¯¼è‡´æ–‡ä»¶çš„è·¯å¾„è¿‡é•¿ï¼Œå®‰è£…é€Ÿåº¦ä¼šå‡æ…¢ï¼Œå¦‚æœéœ€è¦å®šä½åˆ°æŒ‡å®šçš„ä¾èµ–åŒ…ä¹Ÿæ¯”è¾ƒéš¾

## åŒ…å®‰è£…ç­–ç•¥

> å¯¹äºä¸åŒçš„ä¾èµ–ä¸­åˆå…±åŒä¾èµ–æŸä¸€åŒ…çš„ä¸åŒç‰ˆæœ¬ï¼ŒåŒ…ç®¡ç†å·¥å…·ä¼šé‡‡å–ä»€ä¹ˆæ ·çš„ç­–ç•¥ï¼Ÿ

> æˆ‘åœ¨ä¸€ä¸ªé¡¹ç›®ä¸­ç”¨äº†yarnå®‰è£…åï¼Œå†ä½¿ç”¨npmå®‰è£…åæ˜¯å¦ok ï¼ŸåŒç†å…¶ä»–å‡ ç§ç»„åˆ

### ä¾èµ–åŒä¸€ä¸ªç‰ˆæœ¬

å‡å¦‚ A å’Œ B ä¸¤ä¸ªåŒ…ï¼Œä¸¤ä¸ªåŒ…éƒ½ä¾èµ–äº† C è¿™ä¸ªåŒ…ï¼Œåœ¨ä½¿ç”¨å®‰è£…å‘½ä»¤ånpmä¼šå¦‚ä½•å®‰è£…åˆ° node_modules ä¸­ã€‚è¿™é‡Œä»¥ [antd-img-crop](https://www.npmjs.com/package/antd-img-crop) å’Œ [antd-img-cropper](https://www.npmjs.com/package/antd-img-cropper) ä¸¤ä¸ªåŒ…ä¸ºä¾‹å­ï¼Œåè€…forkäº†å‰è€…ï¼Œä¸¤è¾¹çš„ä¾èµ–åŸºæœ¬ä¸€è‡´ï¼Œå¹¶ä¸”äºŒè€…éƒ½ä¾èµ–äº† [react-easy-crop](https://www.npmjs.com/package/react-easy-crop) ï¼Œä¼šåˆ†åˆ«åœ¨ npm v7 åŠ npm 2 ç‰ˆæœ¬æŸ¥çœ‹å®‰è£…æƒ…å†µï¼š

- å·¦ï¼šæœ¬åœ°å½“å‰ v7.17 ç‰ˆæœ¬ ä¸­ + å³ï¼šv2.0.0 æ—§ç‰ˆæœ¬

![](https://assets.wuxinhua.com/blog/assets/npm/1.0.0.png)
![](https://assets.wuxinhua.com/blog/assets/npm/2.0.0.png)
![](https://assets.wuxinhua.com/blog/assets/npm/2.0.01.png)

- åœ¨ v2 ç‰ˆæœ¬ä¸­ï¼Œnpm2ä¼šä¾æ¬¡é€’å½’å®‰è£… a b ä¿©ä¸ªåŒ…åˆ° node_modules ä¸­ï¼Œç›¸åŒçš„åŒ…ä¼šåœ¨å„è‡ªçš„ node_modules ä¸­é‡å¤å®‰è£…ä¸€é
- åœ¨ v2 ä»¥ä¸Šçš„ç‰ˆæœ¬ï¼ˆv7.17ï¼‰å®éªŒä¸­ï¼Œnpm å°†ç›®å½•æ‰“å¹³äº†ï¼Œå³é‡‡ç”¨æ‰å¹³åŒ–çš„å±‚çº§ç»“æ„ï¼Œå°†ç›¸åŒçš„ä¾èµ–æ”¾åœ¨ node_modules ä¸­å®ç°å…±äº«

### åŒä¸€ä¾èµ–ä¸åŒç‰ˆæœ¬

ä¾‹å¦‚é¡¹ç›®ä¾èµ–äº† A æ¨¡æ¿ï¼ŒA æ¨¡å—ä¾èµ–äº† B æ¨¡å—ï¼ŒåŒæ—¶ C æ¨¡å—ä¹Ÿä¾èµ– B ï¼Œä½†æ˜¯æ˜¯ B çš„é«˜ç‰ˆæœ¬ï¼Œå¯¹äºè¿™ç§å¤šç‰ˆæœ¬æƒ…å†µï¼Œnpm çš„å¤„ç†æ˜¯å…ˆæ£€æŸ¥ç‰ˆæœ¬æ˜¯å¦å…¼å®¹ï¼Œå¦‚æœå…¼å®¹å°±ä¸ä¼šå†é‡å¤å®‰è£…ï¼Œå¦‚æœä¸å…¼å®¹åˆ™ä¼šæŠŠä¾èµ–åŒ…å®‰è£…åœ¨å½“å‰å¼•ç”¨åŒ…çš„ node_modulesä¸‹ï¼Œä»¥ä¸Šé¢çš„ä¾‹å­ä¸ºä¾‹ï¼šnpm ä¼šå°†Aæ¨¡æ¿çš„ BåŒ…å®‰è£…åœ¨æ ¹ç›®å½•ä¸‹ï¼Œ å†å°† C æ¨¡å—çš„ B åŒ…å®‰è£…åœ¨ C è‡ªå·±çš„ node_modulesä¸‹ã€‚

## é™„å½•

- [å…³äºç°ä»£åŒ…ç®¡ç†å™¨çš„æ·±åº¦æ€è€ƒâ€”â€”ä¸ºä»€ä¹ˆç°åœ¨æˆ‘æ›´æ¨è pnpm è€Œä¸æ˜¯ npm/yarn?](https://juejin.cn/post/6932046455733485575#heading-0)
- [å‰–ænpmçš„åŒ…ç®¡ç†æœºåˆ¶(å®Œæ•´ç‰ˆ) | ConardLiçš„blog](http://www.conardli.top/blog/article/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96-%E5%89%96%E6%9E%90npm%E7%9A%84%E5%8C%85%E7%AE%A1%E7%90%86%E6%9C%BA%E5%88%B6%EF%BC%88%E5%AE%8C%E6%95%B4%E7%89%88%EF%BC%89.html#_1-3-%E4%BE%9D%E8%B5%96%E9%85%8D%E7%BD%AE)
- [Flat node_modules is not the only way | pnpm ä¸­æ–‡æ–‡æ¡£ | pnpm ä¸­æ–‡ç½‘](https://www.pnpm.cn/blog/2020/05/27/flat-node-modules-is-not-the-only-way)
